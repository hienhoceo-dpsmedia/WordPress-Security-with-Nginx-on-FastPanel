# WordPress Security Configuration - High Priority Version
# File: /etc/nginx/fastpanel2-includes/wordpress-security.conf
# Uses exact match (=) and prefix match (^~) for highest priority

# ========== EXACT MATCH BLOCKS (HIGHEST PRIORITY) ==========
location = /xmlrpc.php { deny all; return 403; }
location = /wp-admin/install.php { deny all; return 403; }
location = /wp-admin/upgrade.php { deny all; return 403; }
location = /wp-content/debug.log { deny all; return 403; }
location = /readme.html { deny all; return 403; }
location = /license.txt { deny all; return 403; }
location = /wp-config.php { deny all; return 403; }
location = /wp-config-sample.php { deny all; return 403; }

# ========== PREFIX MATCH BLOCKS (HIGH PRIORITY) ==========
location ^~ /.git { deny all; return 403; }
location ^~ /.svn { deny all; return 403; }
location ^~ /.ht { deny all; return 403; }

# ========== REGEX BLOCKS (STILL HIGH PRIORITY FOR PHP) ==========
location ~* /wp-content/uploads/.*\.php$ { deny all; return 403; }
location ~* ^/wp-includes/.*\.php$ { deny all; return 403; }
location = /wp-includes/ms-files.php { }  # multisite exception
location ~* wp-config { deny all; return 403; }

# ========== BLOCK BACKUP & LOG FILES ==========
location ~* \.(bak|backup|old|orig|original|php~|php\.save|php\.bak|php#)$ { deny all; return 403; }
location ~* \.(log|sql|swp|swo)$ { deny all; return 403; }

# ========== BLOCK COMPRESSED ARCHIVES IN WP-CONTENT ==========
location ~* ^/wp-content/.*\.(zip|gz|tar|bzip2|7z|rar)$ { deny all; return 403; }

# ========== BLOCK FILES IN PLUGINS & THEMES ==========
location ~* ^/wp-content/plugins/.+\.(txt|log|md)$ { deny all; return 403; }
location ~* ^/wp-content/themes/.+\.(txt|log|md)$  { deny all; return 403; }

# ========== ALLOW COMMON WELL-KNOWN PATHS ==========
location ^~ /.well-known/ { allow all; }

# ========== BLOCK HIDDEN FILES ==========
location ~* /\.user\.ini { deny all; return 403; }
location ~* /\. { deny all; return 403; }

# ========== BLOCK DANGEROUS SCRIPT TYPES ==========
location ~* \.(pl|cgi|py|sh|lua|asp|aspx|exe|dll)$ { deny all; return 403; }

# ========== BLOCK EXPLOIT FILES ==========
location ~* /(timthumb|thumb|thumbnail|phpinfo|webshell|shell|c99|r57|backdoor|evil|hack|mobiquo)\.php$ { deny all; return 403; }

# ========== BLOCK ATTACK PATTERNS ==========
location ~* "(eval\()" { deny all; return 403; }
location ~* "(base64_encode)(.*)(\()" { deny all; return 403; }
location ~* "(GLOBALS|REQUEST)(=|\[|%)" { deny all; return 403; }
location ~* "(<|%3C).*script.*(>|%3)" { deny all; return 403; }
location ~* "(\'|\")(.*)(drop|insert|md5|select|union)" { deny all; return 403; }
location ~* "(boot\.ini|etc/passwd|self/environ)" { deny all; return 403; }
location ~* "(127\.0\.0\.1)" { deny all; return 403; }
location ~* "([a-z0-9]{2000})" { deny all; return 403; }
location ~* "(javascript\:)(.*)(\;)" { deny all; return 403; }
